INSERT INTO [MeuRH].[dbo].[FUN_FUNCIONARIOS]
INSERT INTO FUN_FUNCIONARIOS

('MARIA', 'DE SOUZA', '1990-07-03', NULL),

INSERT INTO FUN_FUNCIONARIOS
(FUN_NOME, FUN_SOBRENOME, FUND_DATA_NASCIMENTO, FUND_OBSERVACOES)
VALUES
('JOÃO', 'DA SILVA', '1980-02-15', 'OBSERVACAO');

INSERT INTO FUN_FUNCIONARIOS
(FUN_NOME, FUN_SOBRENOME, FUND_DATA_NASCIMENTO, FUND_OBSERVACOES)
VALUES
('MARIA', 'DE SOUZA', '1990-07-03', NULL),
('JOSÉ', 'ALENCAR', '1968-12-05', NULL);

SELECT * FROM FUN_FUNCIONARIOS;

SELECT FUN_NOME, FUN_SOBRENOME, FUN_DATA_NASCIMENTO FROM FUN_FUNCIONARIOS;


// CONCATENAR DUAS COLUNAS
SELECT FUN_NOME + ' ' + FUN_SOBRENOME, FUN_DATA_NASCIMENTO
FROM FUN_FUNCIONARIOS;

SELECT FUN_NOME + ' ' + FUN_SOBRENOME AS NOME_COMPLETO, FUN_DATA_NASCIMENTO
FROM FUN_FUNCIONARIOS;

SELECT CONCAT(FUN_NOME, + ' ', + FUN_SOBRENOME) AS NOME_COMPLETO, FUN_DATA_NASCIMENTO
FROM FUN_FUNCIONARIOS;


SELECT FUN_NOME + ' ' + FUN_SOBRENOME + ',' + CAST(FUN_OBSERVACOES AS VARCHAR) AS NOME_COMPLETO, FUN_DATA_NASCIMENTO
FROM FUN_FUNCIONARIOS;


SELECT FUN_NOME + ' ' + FUN_SOBRENOME + ',' + CAST(ISNULL(FUN_OBSERVACOES, ' ') AS VARCHAR) AS NOME_COMPLETO, FUN_DATA_NASCIMENTO
FROM FUN_FUNCIONARIOS;

SELECT CONCAT(FUN_NOME,  ' ',  FUN_SOBRENOME, ',', FUN_OBSERVACOES) AS NOME_COMPLETO, 
FUN_DATA_NASCIMENTO
FROM FUN_FUNCIONARIOS;


SELECT SQL_VARIANT_PROPERTY(FUN_NOME + ' ' + FUN_SOBRENOME + ',' + CAST(ISNULL(FUN_OBSERVACOES, ' ') AS VARCHAR), 'BaseType')
AS NOME_COMPLETO, 
FUN_DATA_NASCIMENTO
FROM FUN_FUNCIONARIOS;

SELECT TOP 1 SQL_VARIANT_PROPERTY(FUN_NOME + ' ' + FUN_SOBRENOME + ',' + CAST(ISNULL(FUN_OBSERVACOES, ' ') AS VARCHAR), 'BaseType')
AS NOME_COMPLETO, 
FUN_DATA_NASCIMENTO
FROM FUN_FUNCIONARIOS;

SELECT CONCAT(FUN_NOME, ' ',FUN_SOBRENOME) AS NOME_COMPLETO,
FUN_DATA_NASCIMENTO
FROM FUN_FUNCIONARIOS
WHERE YEAR(FUN_DATA_NASCIMENTO) = 1980;


SELECT CONCAT(FUN_NOME, ' ',FUN_SOBRENOME) AS NOME_COMPLETO,
FUN_DATA_NASCIMENTO
FROM FUN_FUNCIONARIOS
WHERE YEAR(FUN_DATA_NASCIMENTO) = 1980 AND 
MONTH(FUN_DATA_NASCIMENTO) = 02 OR
MONTH(FUN_DATA_NASCIMENTO) = 02;


SELECT CONCAT(FUN_NOME, ' ',FUN_SOBRENOME) AS NOME_COMPLETO,
FUN_DATA_NASCIMENTO
FROM FUN_FUNCIONARIOS
WHERE DATEDIFF(YEAR, FUN_DATA_NASCIMENTO, GETDATE()) > = 45;

SELECT FUN_NOME, FUN_SOBRENOME
FROM FUN_FUNCIONARIOS
WHERE FUN_OBSERVACOES IS NULL;

SELECT * FROM FUN_FUNCIONARIOS
WHERE FUN_NOME = 'JOÃO';

SELECT * FROM FUN_FUNCIONARIOS
WHERE FUN_NOME = 'JOÃO' COLLATE LATIN1_GENERAL_CI_AI;

ALTER TABLE FUN_FUNCIONARIOS
ADD FUN_CPF CHAR(11) NOT NULL DEFAULT '-';


UPDATE FUN_FUNCIONARIOS 
SET FUN_CPF = '12312312312' 
WHERE FUN_ID = 2;


CREATE TABLE PAC_PONTOS_ACESSO
(
	PAC_ID INT IDENTITY(1,1) PRIMARY KEY,
	PAC_DATA_INICIAL  DATETIME NOT NULL,
	PAC_DATA_FINAL DATETIME DEFAULT NULL,
	FUN_ID INT NOT NULL
);

ALTER TABLE PAC_PONTOS_ACESSO 
ADD CONSTRAINT FK_PAC_PONTOS_ACESSO__FUN_FUNCIONARIOS__FUN_ID
FOREIGN KEY(FUN_ID) REFERENCES FUN_FUNCIONARIOS(FUN_ID);


ALTER TABLE PAC_PONTOS_ACESSO 
ADD CONSTRAINT FK_PAC_PONTOS_ACESSO__FUN_FUNCIONARIOS__FUN_ID
FOREIGN KEY(FUN_ID) REFERENCES FUN_FUNCIONARIOS(FUN_ID);

INSERT INTO PAC_PONTOS_ACESSO (PAC_DATA_INICIAL, FUN_ID)
VALUES ('2017-02-01 07:00:00', 1);

SELECT *FROM PAC_PONTOS_ACESSO;




ALTER TABLE PAC_PONTOS_ACESSO ADD CONSTRAINT CK_PAC_PONTOS_ACESSO__DATA_INCIAL__DATA_FINAL
CHECK 
(
	PAC_DATA_INICIAL < PAC_DATA_FINAL AND
	DATEPART(DAY, PAC_DATA_INICIAL) = DATEPART(DAY, PAC_DATA_FINAL) AND
	DATEPART(MONTH, PAC_DATA_INICIAL) = DATEPART(MONTH, PAC_DATA_FINAL) AND
	DATEPART(YEAR, PAC_DATA_INICIAL) = DATEPART(YEAR, PAC_DATA_FINAL)

);


ALTER TABLE PAC_PONTOS_ACESSO ADD CONSTRAINT CK_PAC_PONTOS_ACESSO__DATA_INCIAL__DATA_FINAL
CHECK 
(
	PAC_DATA_INICIAL < PAC_DATA_FINAL AND
	DAY(PAC_DATA_INICIAL) = DAY(PAC_DATA_FINAL) AND
	MONTH(PAC_DATA_INICIAL) = MONTH(PAC_DATA_FINAL) AND
	YEAR(PAC_DATA_INICIAL) = YEAR(PAC_DATA_FINAL)

);

ALTER TABLE PAC_PONTOS_ACESSO DROP CONSTRAINT CK_PAC_PONTOS_ACESSO__DATA_INCIAL__DATA_FINAL;




UPDATE PAC_PONTOS_ACESSO SET PAC_DATA_FINAL = '2017-02-01 12:00:00'
WHERE PAC_ID = 2;



SELECT *,  PAC_DATA_FINAL - PAC_DATA_INICIAL AS DIFERENCA_DATAS
FROM PAC_PONTOS_ACESSO;


ALTER TABLE PAC_PONTOS_ACESSO ADD CONSTRAINT CK_PAC_PONTOS_ACESSO__DATA_INCIAL__DATA_FINAL
CHECK 
(
	PAC_DATA_INICIAL < PAC_DATA_FINAL AND
	DAY(PAC_DATA_INICIAL) = DAY(PAC_DATA_FINAL) AND
	MONTH(PAC_DATA_INICIAL) = MONTH(PAC_DATA_FINAL) AND
	YEAR(PAC_DATA_INICIAL) = YEAR(PAC_DATA_FINAL)

);

ALTER TABLE PAC_PONTOS_ACESSO DROP CONSTRAINT CK_PAC_PONTOS_ACESSO__DATA_INCIAL__DATA_FINAL;



UPDATE PAC_PONTOS_ACESSO SET PAC_DATA_FINAL = '2017-02-01 12:00:00'
WHERE PAC_ID = 1;

SELECT *,  CAST(PAC_DATA_FINAL - PAC_DATA_INICIAL AS TIME(0)) AS DIFERENCA_DATAS
FROM PAC_PONTOS_ACESSO;

SELECT *,  CONVERT(TIME(0),PAC_DATA_FINAL - PAC_DATA_INICIAL ) AS DIFERENCA_DATAS
FROM PAC_PONTOS_ACESSO;


SELECT  CONCAT(FUN.FUN_SOBRENOME, ', ', FUN.FUN_NOME) AS NOME_FUNCIONARIO,
FUN.FUN_DATA_NASCIMENTO,
PAC.PAC_DATA_INICIAL,
PAC.PAC_DATA_FINAL,
CONVERT(TIME(0), PAC.PAC_DATA_FINAL - PAC.PAC_DATA_INICIAL) AS HORAS_TRABALHADAS
FROM FUN_FUNCIONARIOS AS FUN, PAC_PONTOS_ACESSO AS PAC
WHERE FUN.FUN_ID = PAC.FUN_ID;





SELECT  CONCAT(FUN.FUN_SOBRENOME, ', ', FUN.FUN_NOME) AS NOME_FUNCIONARIO,
FUN.FUN_DATA_NASCIMENTO,
PAC.PAC_DATA_INICIAL,
PAC.PAC_DATA_FINAL,
CONVERT(TIME(0), PAC.PAC_DATA_FINAL - PAC.PAC_DATA_INICIAL) AS HORAS_TRABALHADAS
FROM FUN_FUNCIONARIOS AS FUN
INNER JOIN PAC_PONTOS_ACESSO AS PAC
ON FUN.FUN_ID = PAC.FUN_ID;






SELECT  CONCAT(FUN.FUN_SOBRENOME, ', ', FUN.FUN_NOME) AS NOME_FUNCIONARIO,
FUN.FUN_DATA_NASCIMENTO,
PAC.PAC_DATA_INICIAL,
PAC.PAC_DATA_FINAL,
CONVERT(TIME(0), PAC.PAC_DATA_FINAL - PAC.PAC_DATA_INICIAL) AS HORAS_TRABALHADAS
FROM FUN_FUNCIONARIOS AS FUN
LEFT JOIN PAC_PONTOS_ACESSO AS PAC
ON FUN.FUN_ID = PAC.FUN_ID;




SELECT  CONCAT(FUN.FUN_SOBRENOME, ', ', FUN.FUN_NOME) AS NOME_FUNCIONARIO,
FUN.FUN_DATA_NASCIMENTO,
PAC.PAC_DATA_INICIAL,
PAC.PAC_DATA_FINAL,
CONVERT(TIME(0), PAC.PAC_DATA_FINAL - PAC.PAC_DATA_INICIAL) AS HORAS_TRABALHADAS
FROM FUN_FUNCIONARIOS AS FUN
LEFT JOIN PAC_PONTOS_ACESSO AS PAC
ON FUN.FUN_ID = PAC.FUN_ID
WHERE PAC.PAC_DATA_FINAL IS NULL;


SELECT  DEP.DEP_NOME AS DEPARTAMENTO,
CONCAT(FUN2.FUN_SOBRENOME, ', ', FUN2.FUN_NOME) AS RESPONSAVEL_DEPARTAMENTO,
CONCAT(FUN.FUN_SOBRENOME, ', ', FUN.FUN_NOME) AS FUNCIONARIO,
PAC.PAC_DATA_INICIAL,
PAC.PAC_DATA_FINAL,
CONVERT(TIME(0), PAC.PAC_DATA_FINAL - PAC.PAC_DATA_INICIAL)
FROM FUN_FUNCIONARIOS FUN
LEFT JOIN PAC_PONTOS_ACESSO PAC
ON FUN.FUN_ID = PAC.FUN_ID
INNER JOIN DEP_DEPARTAMENTOS DEP
ON FUN.DEP_ID = DEP.DEP_ID
INNER JOIN FUN_FUNCIONARIOS FUN2
ON DEP.FUN_ID_RESPONSAVEL = FUN2.FUN_ID;




SELECT  DEP.DEP_NOME AS DEPARTAMENTO,
CONCAT(FUN2.FUN_SOBRENOME, ', ', FUN2.FUN_NOME) AS RESPONSAVEL_DEPARTAMENTO,
CONCAT(FUN.FUN_SOBRENOME, ', ', FUN.FUN_NOME) AS FUNCIONARIO,
PAC.PAC_DATA_INICIAL,
PAC.PAC_DATA_FINAL,
CONVERT(TIME(0), PAC.PAC_DATA_FINAL - PAC.PAC_DATA_INICIAL) AS HORAS_TRABALHADAS
FROM FUN_FUNCIONARIOS FUN
LEFT JOIN PAC_PONTOS_ACESSO PAC
ON FUN.FUN_ID = PAC.FUN_ID
INNER JOIN DEP_DEPARTAMENTOS DEP
ON FUN.DEP_ID = DEP.DEP_ID
INNER JOIN FUN_FUNCIONARIOS FUN2
ON DEP.FUN_ID_RESPONSAVEL = FUN2.FUN_ID;




SELECT codinst, COUNT(*) FROM aula GROUP BY codinst HAVING COUNT(*) >= 4;




SELECT COUNT(*) FROM FUN_FUNCIONARIOS;
SELECT COUNT(CONVERT(VARCHAR,FUN_OBSERVACOES)) FROM FUN_FUNCIONARIOS;

SELECT MIN(FUN_DATA_NASCIMENTO) FROM FUN_FUNCIONARIOS;
SELECT MAX(FUN_DATA_NASCIMENTO) FROM FUN_FUNCIONARIOS;

SELECT FUN_NOME, FUN_SOBRENOME
FROM FUN_FUNCIONARIOS



WHERE FUN_DATA_NASCIMENTO =(SELECT MIN(FUN_DATA_NASCIMENTO) FROM FUN_FUNCIONARIOS);




SELECT COUNT(*) FROM FUN_FUNCIONARIOS;
SELECT COUNT(CONVERT(VARCHAR,FUN_OBSERVACOES)) FROM FUN_FUNCIONARIOS;

SELECT MIN(FUN_DATA_NASCIMENTO) FROM FUN_FUNCIONARIOS;
SELECT MAX(FUN_DATA_NASCIMENTO) FROM FUN_FUNCIONARIOS;

SELECT FUN_NOME, FUN_SOBRENOME
FROM FUN_FUNCIONARIOS
WHERE FUN_DATA_NASCIMENTO =(SELECT MIN(FUN_DATA_NASCIMENTO) FROM FUN_FUNCIONARIOS);



SELECT FUN_NOME, FUN_SOBRENOME
FROM FUN_FUNCIONARIOS
WHERE FUN_DATA_NASCIMENTO =(SELECT MIN(FUN_DATA_NASCIMENTO) FROM FUN_FUNCIONARIOS);


SELECT DEP.DEP_NOME, COUNT(*) AS QUANTIDADE_FUNCIONARIOS
FROM DEP_DEPARTAMENTOS DEP
INNER JOIN FUN_FUNCIONARIOS FUN
ON DEP.DEP_ID = FUN.FUN_ID
GROUP BY DEP.DEP_NOME;




SELECT * FROM FUN_FUNCIONARIOS;

UPDATE FUN_FUNCIONARIOS SET FUN_SALARIO = 10000 WHERE FUN_ID = 4;


SELECT SUM(FUN_SALARIO) AS FOLHA_SALARIAL FROM FUN_FUNCIONARIOS;

SELECT DEP.DEP_NOME, SUM(FUN.FUN_SALARIO) AS FOLHA_SALARIAL, AVG(FUN.FUN_SALARIO) AS MEDIA_SALARIAL 
FROM DEP_DEPARTAMENTOS  DEP
INNER JOIN FUN_FUNCIONARIOS FUN
ON FUN.DEP_ID = DEP.DEP_ID
GROUP BY DEP.DEP_NOME;




SELECT DATA,
	FUN_ID,
	(
		FORMAT(SUM(DIFERENCA_SEGUNDOS)/3600, '00') + ':' +
		FORMAT((SUM(DIFERENCA_SEGUNDOS)%3600)/60, '00') + ':' +
		FORMAT(((SUM(DIFERENCA_SEGUNDOS)%3600)/60), '00')
	) AS HORAS_TRABALHADAS
FROM(



SELECT DATEDIFF(SECOND, PAC_DATA_INICIAL, PAC_DATA_FINAL) AS DIFERENCA_SEGUNDOS,
CONVERT(DATE, PAC_DATA_INICIAL) AS DATA,
FUN_ID
FROM PAC_PONTOS_ACESSO

) AS DADOS_PONTO
GROUP BY DATA, FUN_ID;





SELECT DATA,
	FUN_ID,
	(
		FORMAT(SUM(DIFERENCA_SEGUNDOS)/3600, '00') + ':' +
		FORMAT((SUM(DIFERENCA_SEGUNDOS)%3600)/60, '00') + ':' +
		FORMAT(((SUM(DIFERENCA_SEGUNDOS)%3600)/60), '00')
	) AS HORAS_TRABALHADAS
FROM(



SELECT DATEDIFF(SECOND, PAC_DATA_INICIAL, PAC_DATA_FINAL) AS DIFERENCA_SEGUNDOS,
CONVERT(DATE, PAC_DATA_INICIAL) AS DATA,
FUN_ID
FROM PAC_PONTOS_ACESSO


) AS DADOS_PONTO
GROUP BY DATA, FUN_ID
ORDER BY DATA;




INSERT INTO PAC_PONTOS_ACESSO (PAC_DATA_INICIAL, PAC_DATA_FINAL, FUN_ID)
VALUES ('2017-02-02 07:03:00', '2017-02-02 12:20:00', 1);



WITH DADOS_PONTO(DIFERENCA_SEGUNDOS, DATA, FUN_ID) AS
(

SELECT DATEDIFF(SECOND, PAC_DATA_INICIAL, PAC_DATA_FINAL) AS DIFERENCA_SEGUNDOS,
CONVERT(DATE, PAC_DATA_INICIAL) AS DATA,
FUN_ID
FROM PAC_PONTOS_ACESSO

) 

SELECT MIN(DIFERENCA_SEGUNDOS)
FROM DADOS_PONTO;






WITH DADOS_PONTO(DIFERENCA_SEGUNDOS, DATA, FUN_ID) AS
(

SELECT DATEDIFF(SECOND, PAC_DATA_INICIAL, PAC_DATA_FINAL) AS DIFERENCA_SEGUNDOS,
CONVERT(DATE, PAC_DATA_INICIAL) AS DATA,
FUN_ID
FROM PAC_PONTOS_ACESSO

) 

SELECT FUN_ID, DIFERENCA_SEGUNDOS
FROM DADOS_PONTO
WHERE DIFERENCA_SEGUNDOS IN (SELECT MIN(DIFERENCA_SEGUNDOS) FROM DADOS_PONTO);










WITH DADOS_PONTO(DIFERENCA_SEGUNDOS, DATA, FUN_ID) AS
(

SELECT DATEDIFF(SECOND, PAC_DATA_INICIAL, PAC_DATA_FINAL) AS DIFERENCA_SEGUNDOS,
CONVERT(DATE, PAC_DATA_INICIAL) AS DATA,
FUN_ID
FROM PAC_PONTOS_ACESSO

) 

SELECT FUN_ID, DIFERENCA_SEGUNDOS
FROM DADOS_PONTO
WHERE DIFERENCA_SEGUNDOS IN (SELECT MIN(DIFERENCA_SEGUNDOS) FROM DADOS_PONTO) OR
DIFERENCA_SEGUNDOS IN (SELECT MAX(DIFERENCA_SEGUNDOS) FROM DADOS_PONTO);










WITH DADOS_PONTO(DIFERENCA_SEGUNDOS, DATA, FUN_ID) AS
(
	SELECT DATEDIFF(SECOND, PAC_DATA_INICIAL, PAC_DATA_FINAL) AS DIFERENCA_SEGUNDOS,
	CONVERT(DATE, PAC_DATA_INICIAL) AS DATA,
	FUN_ID
	FROM PAC_PONTOS_ACESSO
) 
SELECT DADOS_PONTO.DATA,
	CONCAT(FUN.FUN_SOBRENOME,', ',FUN.FUN_NOME) AS NOME_FUNCIONARIO,
	DBO.FN_CALCULA_HORA(SUM(DADOS_PONTO.DIFERENCA_SEGUNDOS)) AS HORAS_TRABALHADAS
FROM DADOS_PONTO 
INNER JOIN FUN_FUNCIONARIOS FUN
	ON FUN.FUN_ID = DADOS_PONTO.FUN_ID
GROUP BY DADOS_PONTO.DATA, CONCAT(FUN.FUN_SOBRENOME,', ',FUN.FUN_NOME) 
ORDER BY DADOS_PONTO.DATA;















WITH DADOS_PONTO(DIFERENCA_SEGUNDOS, DATA, FUN_ID) AS
(
	SELECT DATEDIFF(SECOND, PAC_DATA_INICIAL, PAC_DATA_FINAL) AS DIFERENCA_SEGUNDOS,
	CONVERT(DATE, PAC_DATA_INICIAL) AS DATA,
	FUN_ID
	FROM PAC_PONTOS_ACESSO
) 
SELECT DADOS_PONTO.DATA,
	CONCAT(FUN.FUN_SOBRENOME,', ',FUN.FUN_NOME) AS NOME_FUNCIONARIO,
	DBO.FN_CALCULA_HORA(SUM(DADOS_PONTO.DIFERENCA_SEGUNDOS)) AS HORAS_TRABALHADAS
FROM DADOS_PONTO 
INNER JOIN FUN_FUNCIONARIOS FUN
	ON FUN.FUN_ID = DADOS_PONTO.FUN_ID
GROUP BY DADOS_PONTO.DATA, CONCAT(FUN.FUN_SOBRENOME,', ',FUN.FUN_NOME) 
ORDER BY DADOS_PONTO.DATA;





ALTER FUNCTION FN_CALCULA_HORA(@P_QTDE_SEGUNDOS INT)
RETURNS VARCHAR(8) AS 
BEGIN
	DECLARE @RESULTADO VARCHAR(8);
	
	SET @RESULTADO =	FORMAT(@P_QTDE_SEGUNDOS/3600, '00') + ':'  ;
	SET @RESULTADO = @RESULTADO +	FORMAT((@P_QTDE_SEGUNDOS%3600)/60, '00') + ':'  ;
	SET @RESULTADO = @RESULTADO +	FORMAT(((@P_QTDE_SEGUNDOS%3600)/60), '00') ;
	RETURN @RESULTADO;
END;









SELECT DADOS_PONTO.DATA,
	CONCAT(FUN.FUN_SOBRENOME,', ',FUN.FUN_NOME) AS NOME_FUNCIONARIO,
	DBO.FN_CALCULA_HORA(SUM(DADOS_PONTO.DIFERENCA_SEGUNDOS)) AS HORAS_TRABALHADAS
FROM DBO.FN_DADOS_PONTO() AS DADOS_PONTO
INNER JOIN FUN_FUNCIONARIOS FUN
	ON FUN.FUN_ID = DADOS_PONTO.FUN_ID
GROUP BY DADOS_PONTO.DATA, CONCAT(FUN.FUN_SOBRENOME,', ',FUN.FUN_NOME) 
ORDER BY DADOS_PONTO.DATA;





DROP FUNCTION FN_DADOS_PONTO;

CREATE FUNCTION FN_DADOS_PONTO(@P_FUN_ID INT = NULL)
RETURNS @RESULTADO TABLE
(
	DIFERENCA_SEGUNDOS INT,
	DATA DATE,
	FUN_ID INT
)
AS
BEGIN
	IF @P_FUN_ID IS NULL
	BEGIN
		INSERT INTO @RESULTADO SELECT DATEDIFF(SECOND, PAC_DATA_INICIAL, PAC_DATA_FINAL) AS DIFERENCA_SEGUNDOS,
								CONVERT(DATE, PAC_DATA_INICIAL) AS DATA,
								FUN_ID
							FROM PAC_PONTOS_ACESSO;
		END
		ELSE
		BEGIN
		INSERT INTO @RESULTADO SELECT DATEDIFF(SECOND, PAC_DATA_INICIAL, PAC_DATA_FINAL) AS DIFERENCA_SEGUNDOS,
								CONVERT(DATE, PAC_DATA_INICIAL) AS DATA,
								FUN_ID
							FROM PAC_PONTOS_ACESSO
							WHERE FUN_ID = @P_FUN_ID;
		END;
		RETURN;
END;









SELECT DADOS_PONTO.DATA,
	CONCAT(FUN.FUN_SOBRENOME,', ',FUN.FUN_NOME) AS NOME_FUNCIONARIO,
	DBO.FN_CALCULA_HORA(SUM(DADOS_PONTO.DIFERENCA_SEGUNDOS)) AS HORAS_TRABALHADAS
FROM DBO.FN_DADOS_PONTO(DEFAULT) AS DADOS_PONTO
INNER JOIN FUN_FUNCIONARIOS FUN
	ON FUN.FUN_ID = DADOS_PONTO.FUN_ID
GROUP BY DADOS_PONTO.DATA, CONCAT(FUN.FUN_SOBRENOME,', ',FUN.FUN_NOME) 
ORDER BY DADOS_PONTO.DATA;
